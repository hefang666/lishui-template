(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-72b49817"],{"0160":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"area-panet"},[a("AreaManage"),a("Map",{ref:"map"}),a("AreaInfo",{ref:"areaInfo"})],1)},r=[],i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mapbox"},[a("div",{staticClass:"areamap",attrs:{id:"areamap"}}),a("div",{staticClass:"contextmenu",attrs:{id:"contextmenu_container"}},[a("ul",{staticClass:"contextmenu-lists"},[a("li",[a("a",{attrs:{href:"#",id:"popup-area-select"},on:{click:e.selectByArea}},[e._v("选择区域内设备")])])])]),a("div",{ref:"popup",staticClass:"pop-boxer"},[a("a",{ref:"closer",staticClass:"pop-closer",on:{click:e.closeOverlay}}),a("div",{staticClass:"pop-container"},[a("p",[e._v("设备名称："+e._s(e.currentDeviceInfo.deviceName))]),a("p",[e._v("坐标:"+e._s(e.currentDeviceInfo.devicePoint))]),a("p",[e._v("地址:"+e._s(e.currentDeviceInfo.address))])])])])},o=[],s=(a("a15b"),a("d81d"),a("ac1f"),a("1276"),a("5530")),c=a("4ec3"),l=a("ed08"),u=a("2f62"),d=Object(u["a"])("area"),h=d.mapState,p={data:function(){return{pointLayer:{},lineLayer:{},zoomMap:15,drawAreaSource:{},drawAreaStyle:{},overlay:{},drawMapAreaSource:{},drawMapAreaLayer:{},areaObj:{},menuOverlay:{},featureSelect:{},currentDeviceInfo:{},pointInArea:[],lineInArea:[],selectPointSource:{},selectPointLayer:{},selectLineSource:{},selectLineLayer:{},checkPointSource:{},checkPointLayer:{},checkLineSource:{},checkLineLayer:{}}},computed:Object(s["a"])({},h(["areaList","checkedPoint","checkedLine","areaInfo"])),mounted:function(){this.initMap()},methods:{initMap:function(){var e=this,t=window.SNTGIS,a=new t.layer.TileWMS({url:c["h"],layers:"OpenGIS:GisPoint",layerName:"管点图"});this.pointLayer=a,a.setMaxResolution(107288e-10);var n=new t.layer.TileWMS({url:c["h"],layers:"OpenGIS:GisLine",layerName:"管线图"});this.lineLayer=n;var r=new t.layer.TDMap({token:"7ab767e38fe3d9c04f144a091cff214f",type:1,layerName:"天地图电子底图"}),i=new t.layer.TDMap({token:"7ab767e38fe3d9c04f144a091cff214f",type:4,layerName:"天地图电子底图"}),o=this.zoomMap;this.map=new t.Map({layers:[r,i,a,n],center:[104.1526230224237,30.01244851052735],zoom:o,maxZoom:18,minZoom:5,target:"areamap"}),this.$nextTick((function(){e.drawAreaLayerFunc(),e.initDrawMap(),e.featureSelectComp(),e.initMenuOverLay(),e.initMapOverlay(),e.initSelectPointLayer(),e.initSelelctLineLayer(),e.initCheckPointLayer(),e.initCheckLineLayer()}))},initDrawMap:function(){var e=this,t=window.ol,a=new t.source.Vector({});this.drawMapAreaSource=a;var n=new t.layer.Vector({source:a,updateWhileInteracting:!0,style:e.drawAreaStyle});this.drawMapAreaLayer=n,this.map.addLayer(n)},drawAreaLayerFunc:function(){var e=window.ol,t=new e.style.Style({fill:new e.style.Fill({color:"rgba(75, 119, 190, 0.5)"}),stroke:new e.style.Stroke({color:"rgba(255, 255, 255, 0.5)",width:2}),image:new e.style.Circle({radius:7,fill:new e.style.Fill({color:"rgba(75, 119, 190, 0.5)"})})});this.drawAreaStyle=t;var a=new e.source.Vector({});this.drawAreaSource=a;var n=new e.layer.Vector({source:a,updateWhileInteracting:!0,style:t});this.drawAreaLayer=n,this.map.addLayer(n)},initMenuOverLay:function(){var e=this,t=new window.ol.Overlay({element:document.querySelector("#contextmenu_container"),positioning:"center-center"});this.menuOverlay=t,this.map.addOverlay(t),this.map.getViewport().addEventListener("contextmenu",(function(a){if(e.drawMapAreaSource.getFeatures().length>0){a.preventDefault();var n=e.map.getEventCoordinate(a);t.setPosition(n)}}))},initMapOverlay:function(){var e=this.$refs.popup,t=new window.ol.Overlay({element:e,autoPan:!0,autoPanAnimation:{duration:250},positioning:"center-center"});this.overlay=t,this.map.addOverlay(t)},initSelectPointLayer:function(){var e=new window.ol.style.Style({fill:new window.ol.style.Fill({color:"rgba(196, 211, 231, 0.5)"}),stroke:new window.ol.style.Stroke({color:"rgba(252, 7, 7, 1)",width:3})}),t=new window.ol.source.Vector({});this.selectPointSource=t;var a=new window.ol.layer.Vector({source:t,updateWhileInteracting:!0,style:e});this.selectPointLayer=a,this.map.addLayer(a)},initSelelctLineLayer:function(){var e=new window.ol.style.Style({fill:new window.ol.style.Fill({color:"rgba(252, 7, 7, 0.5)"}),stroke:new window.ol.style.Stroke({color:"rgba(48, 99, 181, 0.5)",width:4})}),t=new window.ol.source.Vector({});this.selectLineSource=t;var a=new window.ol.layer.Vector({source:t,updateWhileInteracting:!0,style:e});this.selectLineLayer=a,this.map.addLayer(a)},initCheckPointLayer:function(){var e=new window.ol.style.Style({fill:new window.ol.style.Fill({color:"rgba(196, 211, 231, 0.5)"}),stroke:new window.ol.style.Stroke({color:"rgba(252, 7, 7, 1)",width:3})}),t=new window.ol.source.Vector({});this.checkPointSource=t;var a=new window.ol.layer.Vector({source:t,updateWhileInteracting:!0,style:e});this.checkPointLayer=a,this.map.addLayer(a)},initCheckLineLayer:function(){var e=new window.ol.style.Style({fill:new window.ol.style.Fill({color:"rgba(252, 7, 7, 0.5)"}),stroke:new window.ol.style.Stroke({color:"rgba(48, 99, 181, 0.5)",width:4})}),t=new window.ol.source.Vector({});this.checkLineSource=t;var a=new window.ol.layer.Vector({source:t,updateWhileInteracting:!0,style:e});this.checkLineLayer=a,this.map.addLayer(a)},setMapOverLayInfo:function(e){this.currentDeviceInfo=e,this.overlay.setPosition(e.devicePoint.split(","))},featureSelectComp:function(){var e=new window.ol.interaction.Select({multi:!0,hitTolerance:5});this.featureSelect=e,this.map.addInteraction(e)},showOrCloseRouteLayer:function(e,t){t?this.showRouteLayer(e,1):this.closeRouteLayer(e)},showRouteLayer:function(e,t){if(!Object(l["d"])(e.areaPoint)){for(var a=e.areaPoint.split(";"),n=new Array,r=new Array,i=new Array,o=0;o<a.length-1;o++){var s=a[o],c=s.split(",");r.push(c[0]),i.push(c[1]),n.push(c)}var u=new window.ol.Feature({geometry:new window.ol.geom.Polygon([n])});1===t?this.drawAreaSource.addFeature(u):this.drawMapAreaSource.addFeature(u);var d=Math.max.apply(null,r),h=Math.min.apply(null,r),p=Math.max.apply(null,i),f=Math.min.apply(null,i);this.map.getView().fit([h,f,d,p])}},closeRouteLayer:function(e){var t=e.areaPoint;if(!Object(l["d"])(t)){for(var a=t.split(";"),n=new Array,r=0;r<a.length-1;r++){var i=a[r],o=i.split(",");n.push(o)}var s=new window.ol.Feature({geometry:new window.ol.geom.Polygon([n])});this.delFeatureFromSource(this.drawAreaSource,s),this.checkPointLayer.getSource().clear(),this.checkLineLayer.getSource().clear()}},delFeatureFromSource:function(e,t){for(var a=e.getFeatures(),n=0;n<a.length;n++){var r=a[n];if(JSON.stringify(t.values_.geometry.flatCoordinates)==JSON.stringify(r.values_.geometry.flatCoordinates))return void e.removeFeature(r)}},drawAreaFunc:function(){var e=this,t=new window.ol.source.Vector({wrapX:!1});this.drawMapAreaSource=t,this.drawMapAreaLayer.setSource(t),this.clearMapLayer();var a=new window.ol.interaction.Draw({source:t,type:"Polygon"});this.map.addInteraction(a),a.on("drawend",(function(t){if(e.checkedLine.length<=0&&e.checkedPoint.length<=0)return e.$message({type:"error",message:"未选中任何管道或者设备图层！",duration:2e3}),e.resetDrawArea(),!1;var n=e.areaObj;n.area="";for(var r=t.feature.values_.geometry.flatCoordinates,i=0;i<r.length;i+=2)n.area+=r[i]+",",n.area+=r[i+1]+";";e.map.removeInteraction(a),e.getCommonEle({areaPoint:n.area})}))},getCommonEle:function(e,t){var a=this,n=e.areaPoint.split(";").join(" ");n=n.substring(0,n.length-1),window.SNTGIS.workSpace=c["j"],window.SNTGIS.NetWork.getFeaturesByCoords(a.lineLayer,n,(function(n){a.lineInArea=n,t&&a.getLineListInArea(n,e.selectLine,t)})),window.SNTGIS.NetWork.getFeaturesByCoords(a.pointLayer,n,(function(n){a.pointInArea=n,t&&a.getPointListInArea(n,e.selectPoint,t)}))},drawEditMapArea:function(e){this.resetDrawArea(),this.showRouteLayer(e,2),this.getCommonEle(e,1)},getMapShowGisLayers:function(){for(var e=this.map.getLayers().getArray(),t=new Array,a=0;a<e.length;a++)e[a].values_.title&&t.push(e[a]);return t},selectByArea:function(){var e=this;if(e.checkedLine.length<=0&&e.checkedPoint.length<=0)return e.$message({type:"error",message:"未选中任何管道或者设备图层！",duration:2e3}),e.resetDrawArea(),this.menuOverlay.setPosition(""),!1;if(e.drawMapAreaSource.getFeatures().length>0){if(this.checkedLine.length<0&&this.checkedPoint.length<0)return this.$message.error("请选择管点或者管线"),!1;this.menuOverlay.setPosition(""),e.getSelectLineList(e.lineInArea,e.checkedLine),e.getSelectPointList(e.pointInArea,e.checkedPoint)}},getLineListInArea:function(e,t,a){for(var n=[],r=0,i=0;i<t.length;i++)for(var o=0;o<e.length;o++)if(t[i].deviceCode==e[o].properties.LineNumber){var s=(e[o].geometry.coordinates[0][0]+e[o].geometry.coordinates[1][0])/2,c=(e[o].geometry.coordinates[0][1]+e[o].geometry.coordinates[1][1])/2;r+=e[i].properties.LineLength,n.push({deviceCode:e[o].properties.LineNumber,deviceName:e[o].properties.Material,devicePoint:s+","+c,address:e[o].properties.Location,deviceLoaction:e[o].geometry.coordinates,lineLength:e[o].properties.LineLength});break}1==a?(this.areaObj.lineLength=r,this.areaObj.lineList=n,this.drawLineSelect(n)):2==a&&this.drawLineCheckFunc(n)},getPointListInArea:function(e,t,a){for(var n=[],r=0;r<t.length;r++)for(var i=0;i<e.length;i++)if(t[r].deviceCode==e[i].properties.PointNumbe){n.push({deviceCode:e[i].properties.PointNumbe,deviceName:e[i].properties.PointName,devicePoint:e[i].geometry.coordinates.join(","),address:e[i].properties.Location,deviceLoaction:e[i].geometry.coordinates});break}1==a?(this.areaObj.selectPoint=n,this.drawPointSelect(n)):2==a&&this.drawPointCheckFunc(n)},getSelectLineList:function(e,t){for(var a=[],n=0,r=0;r<e.length;r++)for(var i=0;i<t.length;i++)if(e[r].properties.Material==t[i].label){var o=(e[r].geometry.coordinates[0][0]+e[r].geometry.coordinates[1][0])/2,s=(e[r].geometry.coordinates[0][1]+e[r].geometry.coordinates[1][1])/2;n+=e[r].properties.LineLength,a.push({deviceCode:e[r].properties.LineNumber,deviceName:e[r].properties.Material,devicePoint:o+","+s,address:e[r].properties.Location,deviceLoaction:e[r].geometry.coordinates,lineLength:e[r].properties.LineLength})}this.areaObj.lineLength=n,this.areaObj.selectLine=a,this.drawLineSelect(a)},getSelectPointList:function(e,t){for(var a=[],n=0;n<e.length;n++)for(var r=0;r<t.length;r++)e[n].properties.PointName==t[r].label&&a.push({deviceCode:e[n].properties.PointNumbe,deviceName:e[n].properties.PointName,devicePoint:e[n].geometry.coordinates.join(","),address:e[n].properties.Location,deviceLoaction:e[n].geometry.coordinates});this.areaObj.selectPoint=a,this.drawPointSelect(a)},drawLineSelect:function(e){for(var t=0;t<e.length;t++){var a=new window.ol.Feature({geometry:new window.ol.geom.Polygon([e[t].deviceLoaction])});this.selectLineSource.addFeature(a)}},drawPointSelect:function(e){for(var t=0;t<e.length;t++){var a=new window.ol.Feature({geometry:new window.ol.geom.Circle(e[t].deviceLoaction,5e-5)});this.selectPointSource.addFeature(a)}},drawPointCheckFunc:function(e){for(var t=0;t<e.length;t++){var a=new window.ol.Feature({geometry:new window.ol.geom.Circle(e[t].deviceLoaction,5e-5)});this.checkPointSource.addFeature(a)}},drawLineCheckFunc:function(e){for(var t=0;t<e.length;t++){var a=new window.ol.Feature({geometry:new window.ol.geom.Polygon([e[t].deviceLoaction])});this.checkLineSource.addFeature(a)}},setAreaObj:function(e){this.areaObj=e},getAreaInfo:function(){return this.areaObj},closeOverlay:function(){return this.overlay.setPosition(void 0),this.$refs.closer.blur(),!1},clearMapLayer:function(){this.selectPointLayer.getSource().clear(),this.selectLineLayer.getSource().clear()},resetDrawArea:function(){var e=this;try{e.featureSelect.getFeatures().clear()}catch(t){e.featureSelect.getFeatures().clear()}this.areaObj={},e.drawMapAreaSource=new window.ol.source.Vector({}),e.drawMapAreaLayer.setSource(e.drawMapAreaSource),e.clearMapLayer(),e.closeOverlay()}}},f=p,m=(a("8868"),a("2877")),g=Object(m["a"])(f,i,o,!1,null,null,null),w=g.exports,v=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"area-manage area-list-namage"},[a("Search",{attrs:{loading:e.loading,icon:"",placeholder:"请输入片区名称"},on:{changeSearch:e.changeSearch,submit:e.submitSearchWord}}),a("div",{staticClass:"area-tabs"},[a("el-tabs",{staticClass:"snt-card-tabs",attrs:{type:"card"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"片区管理",name:"area"}},[a("Area")],1),a("el-tab-pane",{staticClass:"layer-pane",attrs:{label:"图层管理",name:"layer"}},[a("Layer")],1)],1)],1)],1)},y=[],b=a("1427"),L=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"area-lists-box"},[a("div",{staticClass:"table-box area-content-box"},[a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{size:"mini",data:e.areaList,stripe:!0,"tooltip-effect":"dark",height:"100%"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{width:"35",type:"selection"}}),a("el-table-column",{attrs:{prop:"name",label:"片区名称",width:"80","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"pipelineLength",label:"管道长度",width:"65"}}),a("el-table-column",{attrs:{prop:"pointCount",label:"设备点数",width:"65","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{width:"58",label:"显示"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{on:{change:function(a){return e.changeSwitchStatus(t.$index,t.row.switch)}},model:{value:t.row.switch,callback:function(a){e.$set(t.row,"switch",a)},expression:"scope.row.switch"}})]}}])}),a("el-table-column",{attrs:{"label-class-name":"handle",width:"50",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{staticClass:"text-primary",on:{click:function(a){return e.updateCurrentInfo(t.row.id)}}},[e._v("修改")])]}}])})],1)],1),a("div",{staticClass:"page-box"},[a("page",{attrs:{"page-data":[30,40,50,100],total:e.areaListInfo.totalCount,layout:"sizes,pager,jump"},on:{changePageSize:e.changePageSize,changeCurrentPage:e.changeTablePage}})],1)])},S=[],k=(a("4160"),a("b0c0"),a("159b"),a("7a3b")),A=Object(u["a"])("area"),C=A.mapState,P=A.mapActions,I={data:function(){return{}},components:{page:k["a"]},computed:Object(s["a"])({},C(["areaList","areaListInfo"])),mounted:function(){this.getAreaListFunc()},methods:Object(s["a"])(Object(s["a"])({},P(["getAreaListFunc","changeHandleStatus","getAreaDetailInfo","changeAreaInfo","chooseAreaId","changePageCount","changeCurrentPage"])),{},{handleSelectionChange:function(e){var t=[];e.forEach((function(e){t.push(e.id)})),this.chooseAreaId(t)},changeSwitchStatus:function(e,t){var a=this,n=this.areaList[e];console.log(n);var r=this.$parent.$parent.$parent.$parent.$refs.map;t?this.getAreaDetailInfo({id:n.id}).then((function(e){var n=e.result,r=a.$parent.$parent.$parent.$parent.$refs.map,i={lineLength:n.pipelineLength,areaPoint:n.areaPoint,selectLine:n.pipelineLists,selectPoint:n.deviceLists,id:n.id};r.showOrCloseRouteLayer(i,t)})):r.showOrCloseRouteLayer(n,t)},updateCurrentInfo:function(e){var t=this,a=this;this.getAreaDetailInfo({id:e}).then((function(e){var n=e.result;t.changeHandleStatus(2);var r=a.$parent.$parent.$parent.$parent.$refs.map;r.drawEditMapArea({areaPoint:n.areaPoint,selectLine:n.pipelineLists,selectPoint:n.deviceLists});var i={lineLength:n.pipelineLength,area:n.areaPoint,selectLine:n.pipelineLists,selectPoint:n.deviceLists,id:n.id};a.$parent.$parent.$parent.$parent.$refs.areaInfo.setName(n.name),t.changeAreaInfo(i),r.setAreaObj(i)}))},changePageSize:function(e){this.changePageCount(e),this.getAreaListFunc()},changeTablePage:function(e){this.changeCurrentPage(e),this.getAreaListFunc()}})},x=I,O=Object(m["a"])(x,L,S,!1,null,null,null),F=O.exports,$=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{},[a("LayerTree",{staticClass:"area-tree",attrs:{treedata:e.pointList,showcheckbox:e.showcheckbox,title:"管点图层"},on:{checkedChange:e.changePoint}}),a("LayerTree",{staticClass:"area-tree",attrs:{treedata:e.lineList,showcheckbox:e.showcheckbox,title:"管线图层"},on:{checkedChange:e.changeLine}})],1)},_=[],M=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.title?a("div",{staticClass:"tree-title"},[e._v(e._s(e.title))]):e._e(),a("el-tree",{ref:"tree",attrs:{data:e.treedata,"show-checkbox":e.showcheckbox,"node-key":e.keyname,"highlight-current":"","expand-on-click-node":e.expandClickStatus,"check-on-click-node":e.checkClickStatus},on:{"node-click":e.nodeClick,"check-change":e.checkChange},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.data;return a("span",{},[n.icon&&n.icon.startsWith("el-icon")?a("span",{staticClass:"el-icon-delete-solid"}):n.icon?a("span",{staticClass:"tree-icon-img"},[a("img",{attrs:{src:e.host+n.icon}})]):e._e(),a("span",[e._v(e._s(n[e.labelname]))])])}}])})],1)},j=[],N={props:{treedata:{type:Array,default:function(){}},title:{type:String,default:""},keyname:{type:String,default:"type"},labelname:{type:String,default:"label"},showcheckbox:{type:Boolean,default:!1}},data:function(){return{host:c["g"],expandClickStatus:!1,checkClickStatus:!0}},methods:{getCheckedList:function(){return this.$refs.tree.getCheckedKeys()},nodeClick:function(e,t,a){this.$emit("nodeClick",{nodeData:e,node:t,comp:a})},checkChange:function(){var e=this.$refs.tree.getCheckedNodes();this.$emit("checkedChange",e)}}},D=N,T=(a("495c"),Object(m["a"])(D,M,j,!1,null,null,null)),W=T.exports,E=Object(u["a"])("area"),V=E.mapState,B=E.mapActions,z={data:function(){return{showcheckbox:!0}},computed:Object(s["a"])({},V(["pointList","lineList"])),mounted:function(){this.getPointAndLine()},components:{LayerTree:W},methods:Object(s["a"])(Object(s["a"])({},B(["getPointAndLine","changeCheckedPoint","changeCheckedLine"])),{},{nodeClick:function(e){var t=e.nodeData;console.log(t)},changePoint:function(e){this.changeCheckedPoint(e)},changeLine:function(e){this.changeCheckedLine(e)}})},G=z,R=Object(m["a"])(G,$,_,!1,null,null,null),H=R.exports,J=Object(u["a"])("area"),q=J.mapState,U=J.mapActions,Z={data:function(){return{activeName:"area",loading:!1}},computed:Object(s["a"])({},q(["searchName"])),components:{Search:b["a"],Area:F,Layer:H},methods:Object(s["a"])(Object(s["a"])({},U(["getAreaListFunc","changeSearchName"])),{},{submitSearchWord:function(){var e=this;this.loading=!0,this.getAreaListFunc().then((function(){e.loading=!1})).catch((function(){e.loading=!1}))},changeSearch:function(e){this.changeSearchName(e)}})},K=Z,X=Object(m["a"])(K,v,y,!1,null,null,null),Q=X.exports,Y=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"area-handle-btn"},[a("div",{staticClass:"button-box"},[a("el-button",{on:{click:e.addArea}},[e._v("新增片区")]),a("el-button",{attrs:{loading:e.deleteLoading},on:{click:e.deleteArea}},[e._v("删除片区")])],1),a("div",{directives:[{name:"show",rawName:"v-show",value:1===e.handleStatus||2===e.handleStatus,expression:"handleStatus === 1 || handleStatus === 2"}],staticClass:"area-manage right"},[a("div",{staticClass:"area-tabs"},[a("div",{staticClass:"area-lists-box area-info"},[a("div",{staticClass:"area-content-box"},[a("div",{staticClass:"area-title"},[e._v("范围绘制")]),a("div",{staticClass:"button-box area-draw text-center pt-10 pb-10"},[a("el-button",{attrs:{type:"primary",plain:""},on:{click:e.drawAreaFunc}},[e._v("划区域")]),a("el-button",{attrs:{type:"primary",plain:""},on:{click:e.resetDrawArea}},[e._v("重置范围")])],1),a("div",{staticClass:"area-title"},[e._v("片区信息")]),a("el-form",{ref:"form",staticClass:"mt-10",attrs:{model:e.ruleForm,"label-width":"85px",rules:e.rules}},[a("el-form-item",{attrs:{prop:"name",label:"片区名:"}},[a("el-input",{attrs:{placeholder:"请输入片区名"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1)],1),a("div",{staticClass:"area-title"},[e._v("设备点信息")]),a("div",{staticClass:"button-box text-center mt-10"},[a("el-button",{attrs:{type:"primary",plain:""},on:{click:e.showDeviceList}},[e._v("生成设备列表")]),a("div",{staticClass:"text-left pl-10 mt-10"},[a("span",{staticClass:"mr-20"},[e._v("设备点："+e._s(e.areaInfo.selectPoint?e.areaInfo.selectPoint.length:0)+"个")]),a("span",[e._v(" 管线： "+e._s(e.areaInfo.lineLength?e.areaInfo.lineLength.toFixed(2):0)+"km")])])],1),a("el-tabs",{staticClass:"snt-card-tabs mt-10",attrs:{type:"card"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"设备",name:"area"}},[a("DeviceTable",{attrs:{type:1,"table-cc":"123",tabledata:e.selectPoint},on:{deleteDevice:e.deleteDeviceFunc,showInfo:e.showPointInfo}})],1),a("el-tab-pane",{attrs:{label:"管道",name:"layer"}},[a("DeviceTable",{attrs:{type:2,"table-cc":"123",tabledata:e.selectLine},on:{deleteDevice:e.deleteDeviceFunc,showInfo:e.showLineInfo}})],1)],1)],1),a("div",{staticClass:"page-box button-box text-right"},[a("el-button",{attrs:{loading:e.submitLoading,type:"primary"},on:{click:e.saveArea}},[e._v("保存")]),a("el-button",{on:{click:e.cancelUpdate}},[e._v("取消")])],1)])])])])},ee=[],te=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"table-box"},[a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{size:"mini",data:e.tabledata,stripe:!0,"tooltip-effect":"dark"}},[a("el-table-column",{attrs:{prop:"deviceCode",label:"设备编号","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"deviceName",label:"设备名称"}}),a("el-table-column",{attrs:{"label-class-name":"handle",width:"80",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{on:{click:function(a){return e.showDeviceInfo(t.$index)}}},[e._v("查看")]),a("a",{staticClass:"ml-5",on:{click:function(a){return e.deleteFunc(t.$index)}}},[e._v("移除")])]}}])})],1)],1)},ae=[],ne=(a("a9e3"),{props:{tabledata:{type:Array,default:function(){}},type:{type:Number,default:1}},methods:{showDeviceInfo:function(e){this.$emit("showInfo",e)},deleteFunc:function(e){this.$emit("deleteDevice",{type:this.type,index:e})}}}),re=ne,ie=Object(m["a"])(re,te,ae,!1,null,null,null),oe=ie.exports,se=Object(u["a"])("area"),ce=se.mapState,le=se.mapActions,ue={data:function(){return{activeName:"area",ruleForm:{name:""},rules:{name:[{required:!0,message:"请输入片区名",trigger:"blur"}]},submitLoading:!1,deleteLoading:!1}},computed:Object(s["a"])({},ce(["areaInfo","handleStatus","selectPoint","selectLine","chooseAreaId"])),mounted:function(){},components:{DeviceTable:oe},methods:Object(s["a"])(Object(s["a"])({},le(["changeAreaInfo","changeHandleStatus","addAreaFunc","updataAreaFunc","deleteAreaFunc","deleteDeviceSigle"])),{},{changeStatus:function(e){this.changeHandleStatus(e)},deleteDeviceFunc:function(e){this.deleteDeviceSigle(e)},addArea:function(){if(this.handleStatus)return this.$alert("请先保存片区！","提示",{confirmButtonText:"确定"}),!1;this.changeAreaInfo({}),this.changeStatus(1)},deleteArea:function(){var e=this;console.log(this.chooseAreaId);var t=this.chooseAreaId;if(t.length<1)return this.$message({type:"error",message:"请先选择要操作的数据"}),!1;this.deleteLoading=!0,this.deleteAreaFunc({id:t}).then((function(){e.deleteLoading=!1})).catch((function(){e.deleteLoading=!1}))},drawAreaFunc:function(){this.$parent.$refs.map.drawAreaFunc()},resetDrawArea:function(){this.$parent.$refs.map.resetDrawArea()},cancelUpdate:function(){this.$refs.form.resetFields(),this.changeStatus(""),this.$parent.$refs.map.resetDrawArea()},showDeviceList:function(){var e=this.$parent.$refs.map.getAreaInfo();this.changeAreaInfo(e)},showPointInfo:function(e){var t=this.areaInfo.selectPoint,a=[];a=t[e],this.$parent.$refs.map.setMapOverLayInfo(a)},showLineInfo:function(e){var t=this.areaInfo.selectLine,a=[];a=t[e],this.$parent.$refs.map.setMapOverLayInfo(a)},setName:function(e){this.ruleForm.name=e},resetArea:function(){this.$refs.form.resetFields(),this.changeAreaInfo({}),this.resetDrawArea()},saveArea:function(){var e=this,t=this;this.$refs.form.validate((function(a){if(!a)return!1;if((!t.areaInfo.selectPoint||t.areaInfo.selectPoint.length<1)&&(!t.areaInfo.selectLine||t.areaInfo.selectLine.length<1))return e.$message({type:"error",message:"请选择设备或者管道"}),!1;e.submitLoading=!0;var n={name:t.ruleForm.name,pipelineLength:t.areaInfo.lineLength||0,pointCount:t.areaInfo.selectPoint.length||0,areaPoint:t.areaInfo.area,deviceLists:t.areaInfo.selectPoint,pipelineLists:t.areaInfo.selectLine};if(1===t.handleStatus)e.addAreaFunc(n).then((function(t){console.log(t),e.resetArea(),e.submitLoading=!1})).catch((function(){e.submitLoading=!1}));else{var r=e.areaInfo.id||"";if(!r)return e.$message({message:"请选择编辑的片区",type:"error",duration:2e3}),!1;n.id=r,e.updataAreaFunc(n).then((function(t){console.log(t),e.resetArea(),e.submitLoading=!1})).catch((function(){e.submitLoading=!1}))}}))}})},de=ue,he=Object(m["a"])(de,Y,ee,!1,null,null,null),pe=he.exports,fe={components:{Map:w,AreaManage:Q,AreaInfo:pe}},me=fe,ge=(a("c4a3"),Object(m["a"])(me,n,r,!1,null,null,null));t["default"]=ge.exports},1427:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"search-box"},[a("el-input",{attrs:{placeholder:e.placeholder,"prefix-icon":e.icon},on:{input:e.changeWords},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}},model:{value:e.searchWords,callback:function(t){e.searchWords=t},expression:"searchWords"}}),e.isButton?a("el-button",{staticClass:"search-button",attrs:{type:"primary",loading:e.loading},domProps:{innerHTML:e._s(e.text)},on:{click:e.submit}}):e._e()],1)},r=[],i={props:{icon:{type:String,default:"el-icon-search"},text:{type:String,default:"查询"},isButton:{type:Boolean,default:!0},placeholder:{type:String,default:"请输入内容"},loading:{type:Boolean,default:!1}},data:function(){return{searchWords:""}},methods:{submit:function(){this.$emit("submit",this.searchWords)},changeWords:function(e){this.$emit("changeSearch",e)}}},o=i,s=(a("fc27"),a("2877")),c=Object(s["a"])(o,n,r,!1,null,null,null);t["a"]=c.exports},"14cf":function(e,t,a){},"2f3b":function(e,t,a){},"495c":function(e,t,a){"use strict";var n=a("74d4"),r=a.n(n);r.a},5305:function(e,t,a){},"74d4":function(e,t,a){e.exports={menuText:"#bfcbd9",menuActiveText:"#4b77be",subMenuActiveText:"#f4f4f5",menuBg:"#304156",menuHover:"#e4efff",subMenuBg:"#c7ddfd",subMenuHover:"#e4efff",sideBarWidth:"190px",borderColor:"#ddd"}},8868:function(e,t,a){"use strict";var n=a("5305"),r=a.n(n);r.a},c4a3:function(e,t,a){"use strict";var n=a("14cf"),r=a.n(n);r.a},fc27:function(e,t,a){"use strict";var n=a("2f3b"),r=a.n(n);r.a}}]);
//# sourceMappingURL=chunk-72b49817.6d8faaf3.js.map