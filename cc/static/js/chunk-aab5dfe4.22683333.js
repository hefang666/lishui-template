(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-aab5dfe4"],{"228a":function(e,t,i){},"2a59":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"map-route",style:{width:e.width+"px",height:e.height+"px"}},[i("div",{staticClass:"map",attrs:{id:e.mapid}}),i("div",{ref:"popup",staticClass:"pop-boxer"},[i("a",{ref:"closer",staticClass:"pop-closer",on:{click:e.closeOverlay}}),i("div",{staticClass:"pop-container"},[i("p",[e._v("设备名称："+e._s(e.currentDevice.deviceName))]),i("p",[e._v("坐标:"+e._s(e.currentDevice.devicePoint))]),i("p",[e._v("地址:"+e._s(e.currentDevice.address))])])])])},o=[],n=(i("a15b"),i("d81d"),i("ac1f"),i("1276"),i("4ec3")),r=i("ed08"),s={props:{width:{type:String,default:""},height:{type:String,default:""},mapid:{type:String,default:"map"}},data:function(){return{areaInfo:{},map:{},pointLayer:{},lineLayer:{},zoomMap:"16",geoserverUrl:n["c"],geoserverUrlConstPoint:n["e"],geoserverUrlConstLine:n["d"],featureSelect:{},drawNavRouteSource:{},drawAreaSoure:{},drawPointSource:{},drawLineSource:{},overlay:{},featureType:"",currentFeature:{},pathObj:{},pointListInArea:[],lineListInArea:[],currentDevice:{},drawPointLayer:{},drawLineLayer:{},drawAreaLayer:{},mapLocation:[]}},mounted:function(){var e=window.SNTGIS,t=new e.layer.TileWMS({url:n["h"],layers:"OpenGIS:GisPoint",layerName:"管点图"});this.pointLayer=t,t.setMaxResolution(107288e-10);var i=new e.layer.TileWMS({url:n["h"],layers:"OpenGIS:GisLine",layerName:"管线图"});this.lineLayer=i;var a=new e.layer.TDMap({token:"7ab767e38fe3d9c04f144a091cff214f",type:1,layerName:"天地图电子底图"}),o=new e.layer.TDMap({token:"7ab767e38fe3d9c04f144a091cff214f",type:4,layerName:"天地图电子底图"}),r=this.zoomMap;this.map=new e.Map({layers:[a,o,t,i],center:[104.1526230224237,30.01244851052735],zoom:r,maxZoom:18,minZoom:5,target:this.mapid}),this.init()},methods:{init:function(){this.drawAreaLayerFunc(),this.addInteraction(),this.mapOverlay(),this.drawLineLayerFunc(),this.drawPointLayerFunc()},drawAreaLayerFunc:function(){var e=new window.ol.style.Style({fill:new window.ol.style.Fill({color:"rgba(75, 119, 190, 0.5)"}),stroke:new window.ol.style.Stroke({color:"rgba(255, 255, 255, 0.5)",width:2}),image:new window.ol.style.Circle({radius:7,fill:new window.ol.style.Fill({color:"rgba(75, 119, 190, 0.5)"})})}),t=new window.ol.source.Vector({});this.drawAreaSoure=t;var i=new window.ol.layer.Vector({source:t,updateWhileInteracting:!0,style:e});this.drawAreaLayer=i,this.map.addLayer(i)},drawLineLayerFunc:function(){var e=new window.ol.style.Style({fill:new window.ol.style.Fill({color:"rgba(252, 7, 7, 0.5)"}),stroke:new window.ol.style.Stroke({color:"rgba(48, 99, 181, 0.5)",width:4})}),t=new window.ol.source.Vector({});this.drawLineSource=t;var i=new window.ol.layer.Vector({source:t,updateWhileInteracting:!0,style:e});this.drawLineLayer=i,this.map.addLayer(i)},drawPointLayerFunc:function(){var e=new window.ol.style.Style({fill:new window.ol.style.Fill({color:"rgba(196, 211, 231, 0.5)"}),stroke:new window.ol.style.Stroke({color:"rgba(252, 7, 7, 1)",width:3})}),t=new window.ol.source.Vector({});this.drawPointSource=t;var i=new window.ol.layer.Vector({source:t,updateWhileInteracting:!0,style:e});this.drawPointLayer=i,this.map.addLayer(i)},addInteraction:function(){var e=new window.ol.interaction.Select({multi:!0,hitTolerance:2});this.featureSelect=e,this.map.addInteraction(this.featureSelect)},setAreaInfo:function(e){if(!e.areaPoint)return!1;e.areaPoint=e.areaPoint.substring(0,e.areaPoint.length-1),this.areaInfo=e,this.showAreaMap()},showAreaMap:function(){if(!this.areaInfo.areaPoint)return!1;var e=this.areaInfo,t=e.areaPoint,i=e.deviceLists,a=e.pipelineLists,o=new Array,n=new Array;if(!Object(r["d"])(t)){for(var s=t.split(";"),l=new Array,c=0;c<s.length-1;c++){var d=s[c],u=d.split(",");o.push(u[0]),n.push(u[1]),l.push(u)}var p=new window.ol.Feature({geometry:new window.ol.geom.Polygon([l])});this.drawAreaSoure.addFeature(p);var h=Math.max.apply(null,o),f=Math.min.apply(null,o),w=Math.max.apply(null,n),v=Math.min.apply(null,n);this.mapLocation.push(f,v,h,w),this.map.getView().fit([f,v,h,w])}this.getCommonEle(t,i,a)},getCommonEle:function(e,t,i){var a=this,o=e.split(";").join(" ");window.SNTGIS.workSpace=n["j"],t.length>0&&window.SNTGIS.NetWork.getFeaturesByCoords(a.pointLayer,o,(function(e){a.pointListInArea=e;var i=a.getSelectPointList(e,t);a.drawPointSelect(i)})),i.length>0&&window.SNTGIS.NetWork.getFeaturesByCoords(a.lineLayer,o,(function(e){a.lineListInArea=e;var t=a.getSelectLineList(e,i);a.drawLineSelect(t)}))},drawLineSelect:function(e){for(var t=0;t<e.length;t++){var i=new window.ol.Feature({geometry:new window.ol.geom.Polygon([e[t].deviceLoaction])});this.drawLineSource.addFeature(i)}},drawPointSelect:function(e){for(var t=0;t<e.length;t++){var i=new window.ol.Feature({geometry:new window.ol.geom.Circle(e[t].deviceLoaction,5e-5)});this.drawPointSource.addFeature(i)}},getSelectLineList:function(e,t){for(var i=[],a=0;a<t.length;a++)for(var o=0;o<e.length;o++)if(e[o].properties.LineNumber==t[a].deviceCode){var n=(e[o].geometry.coordinates[0][0]+e[o].geometry.coordinates[1][0])/2,r=(e[o].geometry.coordinates[0][1]+e[o].geometry.coordinates[1][1])/2;i.push({deviceCode:e[o].properties.LineNumber,deviceName:e[o].properties.Material,devicePoint:n+","+r,address:e[o].properties.Location,deviceLoaction:e[o].geometry.coordinates});break}return i},getSelectPointList:function(e,t){for(var i=[],a=0;a<t.length;a++)for(var o=0;o<e.length;o++)if(e[o].properties.PointNumbe==t[a].deviceCode){i.push({deviceCode:e[o].properties.PointNumbe,deviceName:e[o].properties.PointName,devicePoint:e[o].geometry.coordinates.join(","),address:e[o].properties.Location,deviceLoaction:e[o].geometry.coordinates});break}return i},mapOverlay:function(){var e=this.$refs.popup,t=new window.ol.Overlay({element:e,autoPan:!0,autoPanAnimation:{duration:250},positioning:"center-center"});this.overlay=t,this.map.addOverlay(t)},closeOverlay:function(){return this.overlay.setPosition(void 0),this.$refs.closer.blur(),!1},clearMapLayer:function(){this.drawPointLayer.getSource().clear(),this.drawLineLayer.getSource().clear(),this.drawAreaLayer.getSource().clear(),this.closeOverlay()},getDeviceTooltip:function(e){var t=this;this.currentDevice=e,this.$nextTick((function(){t.overlay.setPosition(e.devicePoint.split(",")),t.map.getView().fit(t.mapLocation)}))}}},l=s,c=(i("917c"),i("2877")),d=Object(c["a"])(l,a,o,!1,null,null,null);t["a"]=d.exports},"35a7":function(e,t,i){"use strict";var a=i("adb0"),o=i.n(a);o.a},"597c":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"viewRoute-box dialog-box button-box"},[i("el-dialog",{attrs:{title:"查看路线",visible:e.dialogRoute,"before-close":e.closeRoute},on:{"update:visible":function(t){e.dialogRoute=t}}},[i("div",{staticClass:"content-box form-box"},[i("div",{staticClass:"map-box"},[i("map-route",{ref:"map",attrs:{areaInfo:e.areaDetailsInfo,mapid:"ss_"+e.areaDetailsInfo.id}})],1),i("div",{staticClass:"content-right-box"},[i("div",{staticClass:"right-box"},[i("choose-equip",{ref:"equipData",attrs:{"type-text":e.typestr,"type-src":e.typeStr},on:{clickView:e.views}})],1)])]),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.closeRoute}},[e._v("取 消")]),"choose"==e.typestr?i("el-button",{attrs:{type:"primary"},on:{click:e.determine}},[e._v(" 确 定 ")]):e._e()],1)])],1)},o=[],n=(i("d81d"),i("5530")),r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"chooseEquipment-box"},[i("div",{staticClass:"inspection-route-information-box"},[i("div",{staticClass:"inspection-title"},[e._v("巡检路线")]),i("div",{staticClass:"inspection-content"},[i("div",{staticClass:"inspection-info-box-top"},[i("div",{staticClass:"inspection-item"},[i("div",{staticClass:"item-left"},[e._v("路线名称：")]),i("div",{staticClass:"item-right"},[e._v(e._s(e.areaDetailsInfo.name))])]),i("div",{staticClass:"inspection-item"},[i("div",{staticClass:"item-left"},[e._v("设备点：")]),i("div",{staticClass:"item-right"},[e._v(e._s(e.areaDetailsInfo.pointCount))])])])])]),i("div",{staticClass:"equipment-pipeline-information-box"},[i("div",{staticClass:"tabs-box-route"},[i("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("el-tab-pane",{attrs:{label:"设备",name:"equipment"}},[i("div",{staticClass:"equipment-box"},[i("div",{staticClass:"table-box table-box-route"},[i("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.areaDetailsInfo.deviceLists,stripe:!0,border:"","tooltip-effect":"dark","max-height":"420","highlight-current-row":!0},on:{"selection-change":e.clickRowEqui,"row-click":e.clickEqui}},["choose"==e.typeText&&"multiple"==e.typeStr?i("el-table-column",{attrs:{type:"selection",align:"center",width:"50"}}):e._e(),i("el-table-column",{attrs:{align:"center",prop:"deviceCode",label:"设备编号"}}),i("el-table-column",{attrs:{align:"center",prop:"deviceName",label:"设备名称"}}),i("el-table-column",{attrs:{align:"center",label:"操作",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{staticClass:"operate-button",attrs:{type:"text"},on:{click:function(i){return e.handleSeeEquipment(t.row)}}},[e._v("查看")])]}}])})],1)],1)])]),i("el-tab-pane",{attrs:{label:"管道",name:"theConduit"}},[i("div",{staticClass:"theConduit-box"},[i("div",{staticClass:"table-box table-box-route"},[i("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.areaDetailsInfo.pipelineLists,stripe:!0,"tooltip-effect":"dark","max-height":"420",border:"","highlight-current-row":!0},on:{"selection-change":e.clickRowConduit,"row-click":e.clickConduit}},["choose"==e.typeText&&"multiple"==e.typeStr?i("el-table-column",{attrs:{type:"selection",align:"center",width:"50"}}):e._e(),i("el-table-column",{attrs:{align:"center",prop:"deviceCode",label:"设备编号"}}),i("el-table-column",{attrs:{align:"center",prop:"deviceName",label:"设备名称"}}),i("el-table-column",{attrs:{align:"center",label:"操作",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{staticClass:"operate-button",attrs:{type:"text"},on:{click:function(i){return e.handleSeeConduit(t.row)}}},[e._v("查看")])]}}])})],1)],1)])])],1)],1)])])},s=[],l=i("2f62"),c=Object(l["a"])("area"),d=c.mapState,u={name:"ChooseEquipment",props:["typeText","typeStr"],data:function(){return{activeName:"equipment",checkedEqui:[],checkedCon:[],devInfo:""}},computed:Object(n["a"])({},d(["areaDetailsInfo"])),methods:{handleClick:function(e,t){console.log(e,t)},clickRowEqui:function(e){this.checkedEqui=e,console.log(this.checkedEqui)},clickEqui:function(e){console.log(e),this.devInfo=e},clickRowConduit:function(e){this.checkedCon=e,console.log(this.checkedCon)},clickConduit:function(e){console.log(e),this.devInfo=e},handleSeeEquipment:function(e){this.$emit("clickView",e)},handleSeeConduit:function(e){this.$emit("clickView",e)}}},p=u,h=(i("6595"),i("2877")),f=Object(h["a"])(p,r,s,!1,null,"2a8084ba",null),w=f.exports,v=i("2a59"),m=Object(l["a"])("area"),g=m.mapState,y={name:"AddTask",props:{dialogRoute:{type:Boolean,default:!1},typestr:{type:String,default:"view"},typeStr:{type:String,default:"single"}},components:{ChooseEquip:w,MapRoute:v["a"]},computed:Object(n["a"])({},g(["areaDetailsInfo"])),watch:{areaDetailsInfo:function(e){if(!this.$refs.map)return!1;this.$refs.map.setAreaInfo({areaPoint:e.areaPoint,deviceLists:e.deviceLists,pipelineLists:e.pipelineLists})}},data:function(){return{}},methods:{closeRoute:function(){this.$refs.map.clearMapLayer(),console.log("点击了X");var e={dialogRoute:!1,data:[]};this.$emit("getRouteData",e)},changePageSize:function(e){console.log(e)},changeCurrentPage:function(e){console.log(e)},determine:function(){if("single"==this.typeStr){if(""==this.$refs.equipData.devInfo)return void alert("请选择设备或管道");var e={dialogRoute:!1,type:this.typeStr,devInfo:this.$refs.equipData.devInfo};this.$emit("getRouteData",e)}else if("multiple"==this.typeStr){if(0==this.$refs.equipData.checkedEqui.length&&0==this.$refs.equipData.checkedCon.length)return void alert("请选择设备或管道");var t={dialogRoute:!1,type:this.typeStr,equiData:this.$refs.equipData.checkedEqui,conData:this.$refs.equipData.checkedCon};this.$emit("getRouteData",t)}},views:function(e){this.$refs.map.getDeviceTooltip(e)}}},b=y,C=(i("35a7"),Object(h["a"])(b,a,o,!1,null,"36636f57",null));t["a"]=C.exports},6595:function(e,t,i){"use strict";var a=i("7e59"),o=i.n(a);o.a},"6e6c":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"promptMessage-box"},[i("el-dialog",{attrs:{title:"提示",visible:e.dialogMessage,"before-close":e.closeMessage},on:{"update:visible":function(t){e.dialogMessage=t}}},[i("div",{staticClass:"content-box"},[i("div",{staticClass:"message-box"},[i("div",{staticClass:"icon-box"},[i("i",{staticClass:"el-icoon el-icon-warning-outline"})]),i("div",{staticClass:"message"},[e._v(e._s(e.message))])])]),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:e.closeMessage}},[e._v("确 定")])],1)])],1)},o=[],n={props:["dialogMessage","message"],methods:{closeMessage:function(){var e=!1;this.$emit("closeMessage",e)}}},r=n,s=(i("b3ba"),i("2877")),l=Object(s["a"])(r,a,o,!1,null,null,null);t["a"]=l.exports},"7e59":function(e,t,i){},"917c":function(e,t,i){"use strict";var a=i("228a"),o=i.n(a);o.a},a0cb:function(e,t,i){},adb0:function(e,t,i){},b3ba:function(e,t,i){"use strict";var a=i("a0cb"),o=i.n(a);o.a}}]);
//# sourceMappingURL=chunk-aab5dfe4.22683333.js.map